<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HASAN TELECOM Vault</title>

<meta name="theme-color" content="#0f172a">
<link rel="manifest" href="manifest.json">

<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={darkMode:'class'}</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:Inter,sans-serif}
</style>
</head>

<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen p-4 flex flex-col items-center gap-6">

<!-- HEADER -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900 rounded-3xl p-6 shadow-xl text-center">
  <h1 class="text-3xl font-black text-blue-600">HASAN TELECOM</h1>
  <p id="mode" class="text-xs text-slate-400 mt-1">STAFF VIEW MODE</p>

  <div class="flex justify-center gap-3 mt-4">
    <button onclick="toggleTheme()" class="p-3 rounded-xl bg-slate-100 dark:bg-slate-800">
      <span id="themeIcon">ðŸŒ™</span>
    </button>

    <button id="loginBtn" onclick="login()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold">
      LOGIN
    </button>

    <div id="adminTools" class="hidden flex gap-2">
      <button onclick="exportPDF()" class="bg-orange-600 p-3 rounded-xl">ðŸ“„</button>
      <button onclick="exportJSON()" class="bg-emerald-600 p-3 rounded-xl">ðŸ’¾</button>
      <button onclick="logout()" class="bg-red-600 p-3 rounded-xl">âœ•</button>
    </div>
  </div>
</div>

<!-- SEARCH -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900 rounded-3xl p-4 shadow space-y-3">
  <input id="search" oninput="render()" placeholder="Search model / part..."
    class="w-full p-3 rounded-xl bg-slate-100 dark:bg-slate-800 outline-none">

  <div class="grid grid-cols-2 gap-2">
    <select id="brandFilter" onchange="render()" class="p-3 rounded-xl bg-slate-100 dark:bg-slate-800"></select>
    <select id="catFilter" onchange="render()" class="p-3 rounded-xl bg-slate-100 dark:bg-slate-800"></select>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden w-full max-w-xl bg-white dark:bg-slate-900 rounded-3xl p-4 shadow space-y-3">
  <div class="grid grid-cols-2 gap-2">
    <select id="brandSelect" class="p-3 rounded-xl bg-slate-100 dark:bg-slate-800"></select>
    <select id="catSelect" class="p-3 rounded-xl bg-slate-100 dark:bg-slate-800"></select>
  </div>

  <textarea id="bulk" rows="3" placeholder="Model, Price (one per line)"
    class="w-full p-3 rounded-xl bg-slate-100 dark:bg-slate-800"></textarea>

  <button onclick="saveBulk()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">
    SAVE DATA
  </button>

  <button onclick="resetCategory()" class="w-full bg-red-600 text-white py-2 rounded-xl text-sm">
    RESET SELECTED CATEGORY
  </button>
</div>

<!-- LIST -->
<div id="list" class="w-full max-w-xl space-y-3"></div>
<div id="empty" class="hidden text-slate-400 italic">No items found</div>

<script>
/* ---------------- CONFIG ---------------- */
const BRANDS=["SAMSUNG","XIAOMI","OPPO","VIVO","REALME","IPHONE","TECNO","INFINIX","PIXEL"];
const CATEGORIES=["Logic Board","LCD","Ringer","Speaker","Camera","Flex","Housing"];

// âœ… CORRECT SHA-256 of 511436
const ADMIN_HASH="c0b0a9c82f65c8b1b845a70d820ee7da8db36805b97d2519d8cb12c325a4e497";

/* ---------------- STATE ---------------- */
let isAdmin=false;
let db;
let cache=[];

/* ---------------- THEME ---------------- */
function toggleTheme(){
  document.documentElement.classList.toggle("dark");
  const dark=document.documentElement.classList.contains("dark");
  localStorage.theme=dark?"dark":"light";
  themeIcon.textContent=dark?"â˜€ï¸":"ðŸŒ™";
}
if(localStorage.theme==="light") toggleTheme();

/* ---------------- AUTH (FIXED) ---------------- */
async function login(){
  const pass = prompt("Admin Password:")?.trim();
  if(!pass) return;

  const hash = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(pass)
  );

  const hex = [...new Uint8Array(hash)]
    .map(b => b.toString(16).padStart(2,"0"))
    .join("");

  if(hex === ADMIN_HASH){
    isAdmin=true;
    mode.textContent="ADMIN MODE";
    adminPanel.classList.remove("hidden");
    adminTools.classList.remove("hidden");
    loginBtn.classList.add("hidden");
    render();
  } else {
    alert("Wrong password");
  }
}

function logout(){
  isAdmin=false;
  mode.textContent="STAFF VIEW MODE";
  adminPanel.classList.add("hidden");
  adminTools.classList.add("hidden");
  loginBtn.classList.remove("hidden");
  render();
}

/* ---------------- INDEXED DB ---------------- */
const req=indexedDB.open("HT_VAULT",1);
req.onupgradeneeded=e=>{
  db=e.target.result;
  db.createObjectStore("items",{keyPath:"id"});
};
req.onsuccess=e=>{
  db=e.target.result;
  loadAll();
};

function loadAll(){
  const tx=db.transaction("items","readonly").objectStore("items").getAll();
  tx.onsuccess=()=>{cache=tx.result; render();}
}
function save(item){
  const tx=db.transaction("items","readwrite").objectStore("items").put(item);
  tx.onsuccess=loadAll;
}
function removeItem(id){
  const tx=db.transaction("items","readwrite").objectStore("items").delete(id);
  tx.onsuccess=loadAll;
}

/* ---------------- DATA OPS ---------------- */
function saveBulk(){
  const brand=brandSelect.value;
  const cat=catSelect.value;

  bulk.value.split("\n").forEach(line=>{
    if(!line.trim()) return;
    let [name,price]=line.split(",");
    save({
      id:Date.now()+Math.random(),
      brand,cat,
      name:name.trim(),
      price:price?price.trim():"0",
      stock:true
    });
  });
  bulk.value="";
}

function resetCategory(){
  const key=prompt("Type RESET to confirm");
  if(key!=="RESET") return;
  cache.filter(i=>i.cat===catSelect.value)
       .forEach(i=>removeItem(i.id));
}

/* ---------------- RENDER ---------------- */
function render(){
  const q=search.value.toLowerCase();
  const b=brandFilter.value;
  const c=catFilter.value;

  const filtered=cache.filter(i=>{
    return (!q||(`${i.name} ${i.cat}`.toLowerCase().includes(q)))
      &&(b==="ALL"||i.brand===b)
      &&(c==="ALL"||i.cat===c);
  });

  const limited=!isAdmin && q ? filtered.slice(0,30) : filtered;

  const frag=document.createDocumentFragment();
  limited.forEach(i=>{
    const d=document.createElement("div");
    d.className="bg-white dark:bg-slate-900 p-4 rounded-xl shadow flex justify-between items-center";
    d.innerHTML=`
      <div>
        <b>${i.name}</b>
        <div class="text-xs text-slate-400">${i.brand} â€¢ ${i.cat}</div>
      </div>
      <div class="text-right">
        <div class="font-bold text-blue-600">à§³${i.price}</div>
        <div class="text-xs">${i.stock?"ðŸŸ¢":"ðŸ”´"}</div>
      </div>
      ${isAdmin?`<button onclick="removeItem(${i.id})" class="text-red-500">âœ•</button>`:""}
    `;
    frag.appendChild(d);
  });

  list.innerHTML="";
  list.appendChild(frag);
  empty.classList.toggle("hidden",limited.length>0);
}

/* ---------------- PDF ---------------- */
function exportPDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  doc.text("HASAN TELECOM INVENTORY",14,20);
  doc.autoTable({
    startY:30,
    head:[["Brand","Model","Category","Stock","Price"]],
    body:cache.map(i=>[
      i.brand,i.name,i.cat,i.stock?"YES":"NO",`à§³${i.price}`
    ])
  });
  doc.save("inventory.pdf");
}

/* ---------------- JSON ---------------- */
function exportJSON(){
  const blob=new Blob([JSON.stringify(cache)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="hasan_telecom_backup.json";
  a.click();
}

/* ---------------- INIT ---------------- */
function initSelects(){
  brandFilter.innerHTML=`<option>ALL</option>`+BRANDS.map(b=>`<option>${b}</option>`).join("");
  catFilter.innerHTML=`<option>ALL</option>`+CATEGORIES.map(c=>`<option>${c}</option>`).join("");
  brandSelect.innerHTML=BRANDS.map(b=>`<option>${b}</option>`).join("");
  catSelect.innerHTML=CATEGORIES.map(c=>`<option>${c}</option>`).join("");
}
initSelects();
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
