<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HASAN TELECOM - Vault</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={darkMode:'class'}</script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, update, onValue, remove } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD2_M0SwhaQ90wuEVBdDP91zBc2GDWKglQ",
  authDomain: "hasan-telecom-ad91e.firebaseapp.com",
  databaseURL: "https://hasan-telecom-ad91e-default-rtdb.firebaseio.com",
  projectId: "hasan-telecom-ad91e",
  storageBucket: "hasan-telecom-ad91e.appspot.com",
  messagingSenderId: "199331841561",
  appId: "1:199331841561:web:3e2ef8bdb21f222ee5cc88"
};

const app = initializeApp(firebaseConfig);
window.db = getDatabase(app);
</script>

<!-- jsPDF for PDF Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
body { font-family: 'Inter', sans-serif; background-color:#0f172a; }
.group-header:hover { cursor:pointer; background-color: rgba(59,130,246,0.05);}
input::placeholder{ color:#64748b;}
</style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen p-4 md:p-8 flex flex-col items-center gap-6 transition-colors duration-300">

<!-- Header -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-[32px] p-8 flex flex-col items-center text-center shadow-2xl">
  <h1 class="text-3xl font-black text-blue-600 dark:text-blue-500 tracking-tighter uppercase mb-1">HASAN TELECOM</h1>
  <p id="modeIndicator" class="text-[10px] text-slate-400 font-bold tracking-[0.2em] uppercase mb-6">STAFF VIEW MODE</p>

  <div class="flex items-center gap-4">
    <button onclick="toggleTheme()" class="bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 p-4 rounded-2xl hover:scale-105 transition">
      <span id="themeIcon" class="text-xl">üåô</span>
    </button>
    <button id="adminBtn" onclick="toggleAdmin()" class="bg-blue-600 text-white px-10 py-4 rounded-2xl font-black uppercase text-sm tracking-widest shadow-lg shadow-blue-900/40 hover:bg-blue-500 transition">LOGIN</button>
    <div id="adminTools" class="hidden flex gap-2">
      <button onclick="generatePDF()" title="Export PDF" class="bg-orange-600 p-4 rounded-2xl text-white shadow-lg hover:bg-orange-500 transition">üìÑ</button>
      <button onclick="logout()" title="Logout" class="bg-red-600 p-4 rounded-2xl text-white shadow-lg hover:bg-red-500 transition">‚úï</button>
    </div>
  </div>
</div>

<!-- Stats Panel -->
<div id="statsPanel" class="hidden w-full max-w-xl grid grid-cols-3 gap-3 animate-fade-in">
  <div class="bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-200 dark:border-slate-800 text-center">
    <p class="text-[10px] text-slate-400 font-bold uppercase">Total Items</p>
    <p id="statTotal" class="text-xl font-black text-blue-500">0</p>
  </div>
  <div class="bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-200 dark:border-slate-800 text-center">
    <p class="text-[10px] text-slate-400 font-bold uppercase">Out of Stock</p>
    <p id="statLow" class="text-xl font-black text-red-500">0</p>
  </div>
  <div class="bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-200 dark:border-slate-800 text-center">
    <p class="text-[10px] text-slate-400 font-bold uppercase">Brands</p>
    <p id="statBrands" class="text-xl font-black text-emerald-500">0</p>
  </div>
</div>

<!-- Add Item Panel -->
<div id="adminPanel" class="hidden w-full max-w-xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-[32px] p-6 space-y-4 shadow-xl">
  <input type="text" id="brandInput" placeholder="Brand" class="w-full p-3 border rounded" />
  <input type="text" id="categoryInput" placeholder="Category" class="w-full p-3 border rounded" />
  <input type="text" id="subCategoryInput" placeholder="Sub-Category (Optional)" class="w-full p-3 border rounded" />

  <div id="modelsContainer">
    <div class="flex gap-2 mb-2 model-row">
      <input type="text" class="modelNameInput p-2 border rounded" placeholder="Model Name">
      <input type="text" class="modelPriceInput p-2 border rounded" placeholder="Price ‡ß≥">
      <button type="button" onclick="removeRow(this)" class="bg-red-500 text-white px-2 rounded">‚úï</button>
    </div>
  </div>
  <button type="button" onclick="addRow()" class="bg-blue-500 text-white px-4 py-2 rounded">+ Add Model</button>

  <select id="stockInput" class="p-3 border rounded w-full">
    <option value="true">In Stock</option>
    <option value="false">Out of Stock</option>
  </select>

  <button onclick="addItem()" class="bg-green-600 text-white px-6 py-3 rounded shadow-lg hover:bg-green-500 transition">Save</button>
</div>

<!-- Search & Vault -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-[32px] p-6 space-y-4 shadow-xl">
  <input type="text" id="searchInput" onkeyup="render()" placeholder="Search by model, brand, or category" class="w-full p-3 border rounded"/>
</div>

<div id="vaultContent" class="w-full max-w-xl space-y-3"></div>
<div id="emptyState" class="hidden p-20 text-center text-slate-400 font-bold uppercase text-xs italic">No items found</div>

<script type="module">
import { getDatabase, ref, set, update, onValue, remove } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";
const db = window.db;

// Admin & Theme
const ADMIN_PASSWORD = "511436";
window.isAdmin = false;

// THEME
window.toggleTheme = function() {
  const dark = document.documentElement.classList.toggle("dark");
  localStorage.setItem("theme", dark ? "dark" : "light");
  document.getElementById("themeIcon").innerText = dark ? "‚òÄÔ∏è" : "üåô";
};
if(localStorage.theme==='dark') document.documentElement.classList.add('dark');

// LOGIN
window.toggleAdmin = function() {
  const key = prompt("Admin Key:");
  if(key===ADMIN_PASSWORD){ window.isAdmin=true; updateUI(); }
};
window.logout = function(){ window.isAdmin=false; updateUI(); }

function updateUI(){
  document.getElementById("adminPanel").classList.toggle("hidden", !window.isAdmin);
  document.getElementById("adminTools").classList.toggle("hidden", !window.isAdmin);
  document.getElementById("statsPanel").classList.toggle("hidden", !window.isAdmin);
  document.getElementById("adminBtn").classList.toggle("hidden", window.isAdmin);
  document.getElementById("modeIndicator").innerText = window.isAdmin?"ADMIN AUTHORIZED":"STAFF VIEW MODE";
}

// MODEL ROW MANAGEMENT
window.addRow = function(){
  const container=document.getElementById("modelsContainer");
  const div=document.createElement("div");
  div.className="flex gap-2 mb-2 model-row";
  div.innerHTML=`
    <input type="text" class="modelNameInput p-2 border rounded" placeholder="Model Name">
    <input type="text" class="modelPriceInput p-2 border rounded" placeholder="Price ‡ß≥">
    <button type="button" onclick="removeRow(this)" class="bg-red-500 text-white px-2 rounded">‚úï</button>
  `;
  container.appendChild(div);
};
window.removeRow=function(btn){ btn.parentElement.remove(); };

// SAVE ITEMS
window.addItem=function(){
  const brand=document.getElementById("brandInput").value.trim();
  const category=document.getElementById("categoryInput").value.trim();
  let subCategory=document.getElementById("subCategoryInput").value.trim();
  if(!subCategory) subCategory="‚Äî";
  const stock=document.getElementById("stockInput").value==="true";

  if(!brand || !category) return alert("Brand and Category required");

  const rows=document.querySelectorAll(".model-row");
  if(!rows.length) return alert("Add at least one model");

  const updates={};
  rows.forEach(row=>{
    const model=row.querySelector(".modelNameInput").value.trim();
    let price=row.querySelector(".modelPriceInput").value.trim();
    if(!model) return;
    if(!price.startsWith("‡ß≥")) price="‡ß≥ "+price;
    const id=Date.now().toString()+Math.floor(Math.random()*10000);
    updates[id]={id, brand, category, subCategory, model, price, inStock:stock};
  });

  update(ref(db, "inventory"), updates)
    .then(()=>{
      alert("Saved "+rows.length+" model(s) ‚úÖ");
      document.getElementById("modelsContainer").innerHTML="";
      addRow();
    })
    .catch(err=>alert("Error: "+err.message));
};

// LOAD INVENTORY
let data=[];
function loadInventory(){
  const dbRef=ref(db, "inventory");
  onValue(dbRef, snapshot=>{
    data = snapshot.val()?Object.values(snapshot.val()):[];
    render();
  });
}

// UPDATE PRICE & STOCK
window.updatePrice=function(id,newPrice){
  if(!newPrice.startsWith("‡ß≥")) newPrice="‡ß≥ "+newPrice;
  set(ref(db,"inventory/"+id+"/price"),newPrice);
};
window.toggleStock=function(id){
  const stockRef=ref(db,"inventory/"+id+"/inStock");
  onValue(stockRef,snap=>{ set(stockRef,!snap.val()); },{onlyOnce:true});
};

// PDF EXPORT
window.generatePDF=function(){
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();
  doc.setFontSize(20);
  doc.text("HASAN TELECOM - INVENTORY REPORT",14,20);
  const tableRows=data.map(i=>[i.brand,i.category,i.subCategory,i.model,i.price,i.inStock?"Yes":"No"]);
  doc.autoTable({ startY:30, head:[["Brand","Category","Sub","Model","Price","Stock"]], body:tableRows });
  doc.save("HasanTelecom_Report.pdf");
};

// RENDER
window.render=function(){
  const search=document.getElementById("searchInput").value.toLowerCase();
  const container=document.getElementById("vaultContent");
  const filtered=data.filter(i=>(`${i.brand} ${i.category} ${i.subCategory} ${i.model}`).toLowerCase().includes(search));
  container.innerHTML="";
  filtered.forEach(item=>{
    container.innerHTML+=`
    <div class="bg-white dark:bg-slate-900 rounded-[24px] border border-slate-200 dark:border-slate-800 overflow-hidden shadow-sm p-4 flex justify-between items-center">
      <div>
        <span class="text-[9px] font-black text-orange-500 uppercase tracking-widest bg-orange-100 dark:bg-orange-900/30 px-2 py-1 rounded-lg">${item.brand}</span>
        <div class="text-sm font-bold mt-1">${item.model}</div>
        <div class="text-xs text-slate-400">${item.category} / ${item.subCategory}</div>
      </div>
      <div class="flex flex-col items-end gap-1">
        <div contenteditable="true" onblur="updatePrice('${item.id}', this.innerText)" class="font-mono font-bold text-blue-600 dark:text-blue-400">${item.price}</div>
        <div onclick="toggleStock('${item.id}')" class="cursor-pointer">${item.inStock?"üü¢":"üî¥"}</div>
      </div>
    </div>`;
  });
  document.getElementById("emptyState").classList.toggle("hidden", filtered.length>0);

  if(window.isAdmin){
    document.getElementById("statTotal").innerText=data.length;
    document.getElementById("statLow").innerText=data.filter(i=>!i.inStock).length;
    document.getElementById("statBrands").innerText=new Set(data.map(i=>i.brand)).size;
  }
}

loadInventory();
</script>

</body>
</html>
