<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HASAN TELECOM - Vault</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={darkMode:'class'}</script>

<!-- jsPDF for PDF Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
body { font-family: 'Inter', sans-serif; transition: background-color 0.3s, color 0.3s;}
.group-header:hover { cursor:pointer; background-color: rgba(59,130,246,0.05);}
input::placeholder{ color:#64748b;}
</style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen p-4 md:p-8 flex flex-col items-center gap-6">

<!-- Header -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-[32px] p-8 flex flex-col items-center text-center shadow-2xl">
  <h1 class="text-3xl font-black text-blue-600 dark:text-blue-500 tracking-tighter uppercase mb-1">HASAN TELECOM</h1>
  <p id="modeIndicator" class="text-[10px] text-slate-400 font-bold tracking-[0.2em] uppercase mb-6">STAFF VIEW MODE</p>

  <div class="flex items-center gap-4">
    <button onclick="toggleTheme()" class="bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 p-4 rounded-2xl hover:scale-105 transition">
      <span id="themeIcon" class="text-xl">üåô</span>
    </button>
    <button id="adminBtn" onclick="toggleAdmin()" class="bg-blue-600 text-white px-10 py-4 rounded-2xl font-black uppercase text-sm tracking-widest shadow-lg shadow-blue-900/40 hover:bg-blue-500 transition">LOGIN</button>
    <div id="adminTools" class="hidden flex gap-2">
      <button onclick="generatePDF()" title="Export PDF" class="bg-orange-600 p-4 rounded-2xl text-white shadow-lg hover:bg-orange-500 transition">üìÑ</button>
      <button onclick="logout()" title="Logout" class="bg-red-600 p-4 rounded-2xl text-white shadow-lg hover:bg-red-500 transition">‚úï</button>
    </div>
  </div>
</div>

<!-- Admin Add Item Panel -->
<div id="adminPanel" class="hidden w-full max-w-xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-[32px] p-6 space-y-3 shadow-xl">
  <h2 class="text-blue-600 font-bold mb-2">Add New Item</h2>
  <input type="text" id="brandInput" placeholder="Brand" class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-950 outline-none">
  <input type="text" id="categoryInput" placeholder="Category" class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-950 outline-none">
  <input type="text" id="subCategoryInput" placeholder="Sub-category" class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-950 outline-none">
  <textarea id="modelInput" placeholder="Model (one per line for multiple)" class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-950 outline-none"></textarea>
  <input type="text" id="priceInput" placeholder="Price in BDT (e.g., 3500)" class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-950 outline-none">
  <select id="stockInput" class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-950 outline-none">
    <option value="true">In Stock</option>
    <option value="false">Out of Stock</option>
  </select>
  <button onclick="addItem()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">SAVE ITEM</button>
</div>

<!-- Stats Panel -->
<div id="statsPanel" class="hidden w-full max-w-xl grid grid-cols-3 gap-3 animate-fade-in">
  <div class="bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-200 dark:border-slate-800 text-center">
    <p class="text-[10px] text-slate-400 font-bold uppercase">Total Items</p>
    <p id="statTotal" class="text-xl font-black text-blue-500">0</p>
  </div>
  <div class="bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-200 dark:border-slate-800 text-center">
    <p class="text-[10px] text-slate-400 font-bold uppercase">Out of Stock</p>
    <p id="statLow" class="text-xl font-black text-red-500">0</p>
  </div>
  <div class="bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-200 dark:border-slate-800 text-center">
    <p class="text-[10px] text-slate-400 font-bold uppercase">Brands</p>
    <p id="statBrands" class="text-xl font-black text-emerald-500">0</p>
  </div>
</div>

<!-- Search -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-[32px] p-6 space-y-4 shadow-xl">
  <div class="relative">
    <input type="text" id="searchInput" onkeyup="render()" placeholder="Search by Model/Brand/Category" class="w-full bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-slate-700 p-5 rounded-2xl text-slate-900 dark:text-slate-300 outline-none focus:ring-2 focus:ring-blue-500 transition">
    <span class="absolute right-5 top-5 opacity-20">üîç</span>
  </div>
</div>

<!-- Vault Content -->
<div id="vaultContent" class="w-full max-w-xl space-y-3"></div>
<div id="emptyState" class="hidden p-20 text-center text-slate-400 font-bold uppercase text-xs italic">No items found matching your filter</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD2_M0SwhaQ90wuEVBdDP91zBc2GDWKglQ",
  authDomain: "hasan-telecom-ad91e.firebaseapp.com",
  databaseURL: "https://hasan-telecom-ad91e-default-rtdb.firebaseio.com",
  projectId: "hasan-telecom-ad91e",
  storageBucket: "hasan-telecom-ad91e.appspot.com",
  messagingSenderId: "199331841561",
  appId: "1:199331841561:web:3e2ef8bdb21f222ee5cc88"
};

const app = initializeApp(firebaseConfig);
window.db = getDatabase(app); // make db globally accessible
</script>

<script>
const ADMIN_PASSWORD = "511436";
window.isAdmin = false;

// THEME
window.toggleTheme = function() {
  const dark = document.documentElement.classList.toggle("dark");
  localStorage.setItem("theme", dark ? "dark" : "light");
  document.getElementById("themeIcon").innerText = dark ? "‚òÄÔ∏è" : "üåô";
};

document.addEventListener("DOMContentLoaded", () => {
  if(localStorage.theme === 'dark') document.documentElement.classList.add('dark');
  if(localStorage.theme === 'light') document.documentElement.classList.remove('dark');
  document.getElementById("themeIcon").innerText = document.documentElement.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
});

// ADMIN LOGIN
window.toggleAdmin = function() {
  const key = prompt("Admin Key:");
  if(key === ADMIN_PASSWORD){
    window.isAdmin = true;
    updateUI();
  }
};

window.logout = function() {
  window.isAdmin = false;
  updateUI();
};

function updateUI(){
  document.getElementById("adminPanel").classList.toggle("hidden", !window.isAdmin);
  document.getElementById("adminTools").classList.toggle("hidden", !window.isAdmin);
  document.getElementById("statsPanel").classList.toggle("hidden", !window.isAdmin);
  document.getElementById("adminBtn").classList.toggle("hidden", window.isAdmin);
  document.getElementById("modeIndicator").innerText = window.isAdmin?"ADMIN AUTHORIZED":"STAFF VIEW MODE";
  render();
}

// DATA
window.data = [];
const dbRef = ref(window.db, "inventory");
onValue(dbRef, snapshot=>{
  window.data = snapshot.val() ? Object.values(snapshot.val()) : [];
  render();
});

// ADD ITEM
window.addItem = function(){
  const brand = document.getElementById("brandInput").value.trim();
  const category = document.getElementById("categoryInput").value.trim();
  const subCategory = document.getElementById("subCategoryInput").value.trim();
  const models = document.getElementById("modelInput").value.split("\n").map(m=>m.trim()).filter(Boolean);
  const priceRaw = document.getElementById("priceInput").value.trim();
  const stock = document.getElementById("stockInput").value === "true";

  if(!brand || !category || !models.length || !priceRaw){
    alert("Please fill all required fields");
    return;
  }

  const price = priceRaw.startsWith("‡ß≥") ? priceRaw : "‡ß≥ "+priceRaw;

  models.forEach(model=>{
    const item = {
      id: Date.now().toString() + Math.random(),
      brand,
      category,
      subCategory,
      model,
      price,
      inStock: stock
    };
    set(ref(window.db, "inventory/" + item.id), item);
  });

  alert(models.length + " model(s) saved ‚úÖ");
  document.getElementById("modelInput").value = "";
  document.getElementById("priceInput").value = "";
};

// DELETE ITEM
window.deleteItem = function(id){
  if(confirm("Delete this item?")){
    remove(ref(window.db, "inventory/"+id));
  }
};

// TOGGLE STOCK
window.toggleStock = function(id){
  const item = window.data.find(i=>i.id===id);
  if(item){
    item.inStock = !item.inStock;
    set(ref(window.db, "inventory/"+id), item);
  }
};

// RENDER
function render(){
  const q = document.getElementById("searchInput").value.toLowerCase();
  const vaultContent = document.getElementById("vaultContent");
  const emptyState = document.getElementById("emptyState");
  vaultContent.innerHTML = "";

  const filtered = window.data.filter(i=>
    i.model.toLowerCase().includes(q) ||
    i.brand.toLowerCase().includes(q) ||
    i.category.toLowerCase().includes(q)
  );

  if(filtered.length===0){
    emptyState.classList.remove("hidden");
    return;
  } else emptyState.classList.add("hidden");

  // Group by model
  const grouped = {};
  filtered.forEach(i=>{
    if(!grouped[i.model]) grouped[i.model] = [];
    grouped[i.model].push(i);
  });

  Object.keys(grouped).sort().forEach(model=>{
    const items = grouped[model];
    vaultContent.innerHTML += `
      <div class="bg-white dark:bg-slate-900 rounded-2xl shadow overflow-hidden mb-4">
        <div class="p-4 font-bold text-blue-600 text-lg border-b border-slate-200 dark:border-slate-800">${model}</div>
        <div class="divide-y dark:divide-slate-800">
          ${items.map(i=>`
            <div class="flex justify-between items-center p-3 text-sm">
              <div>
                <span class="text-xs text-orange-500 font-bold">${i.category}</span><br>
                <span class="text-xs text-slate-400">${i.brand}</span>
              </div>
              <div class="font-mono font-bold text-blue-600">${i.price}</div>
              <div onclick="toggleStock('${i.id}')" class="cursor-pointer">${i.inStock?"üü¢":"üî¥"}</div>
              ${window.isAdmin?`<button onclick="deleteItem('${i.id}')" class="text-red-500">‚úï</button>`:""}
            </div>
          `).join("")}
        </div>
      </div>
    `;

  });

  if(window.isAdmin){
    document.getElementById("statTotal").innerText = window.data.length;
    document.getElementById("statLow").innerText = window.data.filter(i=>!i.inStock).length;
    document.getElementById("statBrands").innerText = new Set(window.data.map(i=>i.brand)).size;
  }
}

// PDF EXPORT
window.generatePDF = function(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(20);
  doc.text("HASAN TELECOM - INVENTORY REPORT",14,20);

  const tableRows = [];
  window.data.forEach(i=>{
    tableRows.push([i.brand,i.category,i.subCategory,i.model,i.inStock?"YES":"NO",i.price]);
  });

  doc.autoTable({startY:30, head:[['Brand','Category','Sub-category','Model','Stock','Price']], body:tableRows});
  doc.save("HasanTelecom_Report.pdf");
};
</script>
</body>
</html>
