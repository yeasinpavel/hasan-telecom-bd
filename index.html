<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HASAN TELECOM Vault</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={darkMode:'class'}</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:Inter,sans-serif}
</style>
</head>

<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen p-4 flex flex-col items-center gap-6">

<h1 class="text-3xl font-black text-blue-600">HASAN TELECOM</h1>
<p id="mode" class="text-xs text-slate-400">STAFF MODE</p>

<div class="flex gap-2">
  <button onclick="login()" class="bg-blue-600 text-white px-4 py-2 rounded">ADMIN</button>
  <button onclick="exportBackup()" class="bg-emerald-600 text-white px-4 py-2 rounded">EXPORT</button>
  <button onclick="resetAll()" class="bg-red-600 text-white px-4 py-2 rounded hidden" id="resetBtn">RESET</button>
</div>

<input id="search" placeholder="Search model..." class="w-full max-w-md p-3 rounded bg-slate-200 dark:bg-slate-800">

<div id="list" class="w-full max-w-md space-y-2"></div>

<script>
/* ðŸ” PASSWORD HASH (511436) */
const ADMIN_HASH = "7c6db8fbe8a4b0bff0f6cbf1d8d2bb8b3f62d2d59c93a0e7d6cf1f7d7e1b16c9";
let isAdmin = false;

/* ðŸ“¦ INDEXED DB */
let db;
const request = indexedDB.open("hasanVaultDB", 1);

request.onupgradeneeded = e => {
  db = e.target.result;
  db.createObjectStore("items", { keyPath: "id" });
};

request.onsuccess = e => {
  db = e.target.result;
  render();
};

function getAll(cb){
  const tx = db.transaction("items", "readonly");
  const store = tx.objectStore("items");
  const req = store.getAll();
  req.onsuccess = ()=>cb(req.result||[]);
}

function save(item){
  const tx = db.transaction("items", "readwrite");
  tx.objectStore("items").put(item);
}

function clearDB(){
  const tx = db.transaction("items", "readwrite");
  tx.objectStore("items").clear();
}

/* ðŸ” LOGIN */
async function login(){
  const pass = prompt("Admin Password:");
  if(!pass) return;

  const hash = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(pass)
  );
  const hex = [...new Uint8Array(hash)].map(b=>b.toString(16).padStart(2,"0")).join("");

  if(hex === ADMIN_HASH){
    isAdmin = true;
    document.getElementById("mode").innerText="ADMIN MODE";
    document.getElementById("resetBtn").classList.remove("hidden");
    alert("Admin Authorized");
    render();
  } else {
    alert("Wrong Password");
  }
}

/* ðŸ§¹ RESET */
function resetAll(){
  const key = prompt("Type: RESET HASAN TELECOM");
  if(key === "RESET HASAN TELECOM"){
    clearDB();
    alert("All data erased");
    render();
  }
}

/* â˜ï¸ EXPORT */
function exportBackup(){
  getAll(data=>{
    const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "HasanTelecom_Backup.json";
    a.click();
    alert("Upload this file to Google Drive manually");
  });
}

/* ðŸ” RENDER */
function render(){
  const q = document.getElementById("search").value.toLowerCase();
  getAll(items=>{
    const filtered = items.filter(i=>i.name.toLowerCase().includes(q));
    const limit = isAdmin ? filtered : filtered.slice(0,30);

    const frag = document.createDocumentFragment();
    document.getElementById("list").innerHTML="";

    limit.forEach(i=>{
      const d = document.createElement("div");
      d.className="bg-white dark:bg-slate-900 p-3 rounded shadow flex justify-between";
      d.innerHTML = `
        <b>${i.name}</b>
        <span>${i.stock?"ðŸŸ¢":"ðŸ”´"} à§³${i.price}</span>
      `;
      frag.appendChild(d);
    });

    document.getElementById("list").appendChild(frag);
  });
}

/* ðŸ“± PWA */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}

document.getElementById("search").oninput = render;
</script>

</body>
</html>
