<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HASAN TELECOM Vault</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={darkMode:'class'}</script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD2_M0SwhaQ90wuEVBdDP91zBc2GDWKglQ",
  authDomain: "hasan-telecom-ad91e.firebaseapp.com",
  databaseURL: "https://hasan-telecom-ad91e-default-rtdb.firebaseio.com",
  projectId: "hasan-telecom-ad91e",
  storageBucket: "hasan-telecom-ad91e.firebasestorage.app",
  messagingSenderId: "199331841561",
  appId: "1:199331841561:web:3e2ef8bdb21f222ee5cc88"
};

const app = initializeApp(firebaseConfig);
window.db = getDatabase(app);
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
body { font-family: 'Inter', sans-serif; }
input::placeholder{ color:#64748b;}
</style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen p-4 md:p-8 flex flex-col items-center gap-6 transition-colors duration-300">

<!-- Header -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900 border rounded-2xl p-6 flex flex-col items-center text-center shadow-2xl">
  <h1 class="text-3xl font-black text-blue-600 dark:text-blue-500 uppercase mb-1">HASAN TELECOM</h1>
  <p id="modeIndicator" class="text-xs text-slate-400 font-bold mb-4">STAFF VIEW MODE</p>

  <div class="flex items-center gap-4">
    <button onclick="toggleTheme()" class="bg-slate-100 dark:bg-slate-800 p-3 rounded-2xl">
      <span id="themeIcon">üåô</span>
    </button>
    <button id="adminBtn" onclick="toggleAdmin()" class="bg-blue-600 text-white px-6 py-3 rounded-2xl font-bold">LOGIN</button>
    <div id="adminTools" class="hidden flex gap-2">
      <button onclick="generatePDF()" class="bg-orange-600 px-3 py-2 rounded text-white">PDF</button>
      <button onclick="logout()" class="bg-red-600 px-3 py-2 rounded text-white">LOGOUT</button>
    </div>
  </div>
</div>

<!-- Admin Form -->
<div id="adminForm" class="hidden w-full max-w-xl bg-white dark:bg-slate-900 border rounded-2xl p-6 shadow-xl mt-4 space-y-4">
  <input type="text" id="brandInput" placeholder="Brand" class="w-full p-3 border rounded-lg">
  <input type="text" id="categoryInput" placeholder="Category" class="w-full p-3 border rounded-lg">
  <input type="text" id="subCategoryInput" placeholder="Sub-category (optional)" class="w-full p-3 border rounded-lg">

  <div id="modelsContainer"></div>
  <button type="button" onclick="addRow()" class="bg-blue-500 text-white px-4 py-2 rounded">+ Add Model</button>

  <select id="stockInput" class="w-full p-3 border rounded-lg">
    <option value="true">In Stock üü¢</option>
    <option value="false">Out of Stock üî¥</option>
  </select>

  <button onclick="addItem()" class="bg-green-600 text-white px-6 py-3 rounded w-full font-bold">SAVE</button>
</div>

<!-- Search & Vault -->
<div class="w-full max-w-xl mt-4 bg-white dark:bg-slate-900/50 border rounded-2xl p-4 shadow-xl">
  <input type="text" id="searchInput" onkeyup="render()" placeholder="Search by model..." class="w-full p-3 border rounded-lg">
</div>

<div id="vaultContent" class="w-full max-w-xl space-y-3 mt-4"></div>
<div id="emptyState" class="hidden p-10 text-center text-slate-400 font-bold uppercase text-xs italic">No items found</div>

<script type="module">
import { ref, onValue, set, remove, get } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const ADMIN_PASSWORD = "511436";
let data = [];
let isAdmin = false;

// THEME
function toggleTheme(){
  const dark = document.documentElement.classList.toggle('dark');
  localStorage.setItem('theme', dark?'dark':'light');
  document.getElementById('themeIcon').innerText = dark?'‚òÄÔ∏è':'üåô';
}
if(localStorage.theme==='light'){ document.documentElement.classList.remove('dark'); document.getElementById('themeIcon').innerText='üåô'; }

// LOGIN
function toggleAdmin(){
  const key = prompt("Admin Key:");
  if(key===ADMIN_PASSWORD){ isAdmin=true; updateUI(); }
}
function logout(){ isAdmin=false; updateUI(); }

function updateUI(){
  document.getElementById('adminTools').classList.toggle('hidden', !isAdmin);
  document.getElementById('adminForm').classList.toggle('hidden', !isAdmin);
  document.getElementById('adminBtn').classList.toggle('hidden', isAdmin);
  document.getElementById('modeIndicator').innerText = isAdmin?"ADMIN AUTHORIZED":"STAFF VIEW MODE";
  render();
}

// MODELS FORM
window.addRow = function(){
  const container = document.getElementById("modelsContainer");
  const div = document.createElement("div");
  div.className="flex gap-2 mb-2 model-row";
  div.innerHTML = `
    <input type="text" class="modelNameInput p-2 border rounded" placeholder="Model Name">
    <input type="text" class="modelPriceInput p-2 border rounded" placeholder="Price ‡ß≥">
    <button type="button" onclick="removeRow(this)" class="bg-red-500 text-white px-2 rounded">‚úï</button>
  `;
  container.appendChild(div);
};
window.removeRow = function(btn){ btn.parentElement.remove(); };

// ADD ITEM
window.addItem = async function(){
  const brand = document.getElementById("brandInput").value.trim();
  const category = document.getElementById("categoryInput").value.trim();
  let subCategory = document.getElementById("subCategoryInput").value.trim();
  if(!subCategory) subCategory = "‚Äî";
  const stock = document.getElementById("stockInput").value === "true";

  if(!brand || !category) return alert("Brand and Category required");

  const rows = document.querySelectorAll(".model-row");
  if(!rows.length) return alert("Add at least one model");

  try {
    for(const row of rows){
      const model = row.querySelector(".modelNameInput").value.trim();
      let price = row.querySelector(".modelPriceInput").value.trim();
      if(!model) continue;
      if(!price.startsWith("‡ß≥")) price = "‡ß≥ " + price;
      const id = Date.now().toString() + Math.floor(Math.random()*10000);
      await set(ref(db,"inventory/"+id), {id, brand, category, subCategory, model, price, inStock:stock});
    }
    alert(`Saved ${rows.length} model(s) ‚úÖ`);
    document.getElementById("modelsContainer").innerHTML = "";
    addRow();
    document.getElementById("brandInput").value="";
    document.getElementById("categoryInput").value="";
    document.getElementById("subCategoryInput").value="";
  } catch(err){ alert("Error: "+err.message); }
};

// LOAD DATA
function loadInventory(){
  const dbRef = ref(db,"inventory");
  onValue(dbRef, snapshot=>{
    const val = snapshot.val();
    data = val?Object.values(val):[];
    render();
  });
}

// RENDER VAULT
window.render = function(){
  const search = document.getElementById("searchInput").value.toLowerCase();
  const container = document.getElementById("vaultContent");
  const filtered = data.filter(i=>`${i.model} ${i.brand} ${i.category} ${i.subCategory}`.toLowerCase().includes(search));
  container.innerHTML="";
  filtered.forEach(item=>{
    container.innerHTML+=`
    <div class="bg-white dark:bg-slate-900 rounded-2xl border p-4 flex justify-between items-center">
      <div>
        <span class="text-xs font-black text-orange-500 uppercase bg-orange-100 px-2 py-1 rounded-lg">${item.brand}</span>
        <h3 class="font-bold text-lg dark:text-white mt-1">${item.model}</h3>
        <div class="text-xs">${item.category} > ${item.subCategory}</div>
      </div>
      <div class="flex flex-col items-end gap-1">
        ${isAdmin?`<div contenteditable="true" onblur="updatePrice('${item.id}', this.innerText)" class="font-mono font-bold text-blue-600">${item.price}</div>`:`<div class="font-mono font-bold text-blue-600">${item.price}</div>`}
        <div onclick="toggleStock('${item.id}')" class="cursor-pointer">${item.inStock?"üü¢":"üî¥"}</div>
        ${isAdmin?`<button onclick="deleteItem('${item.id}')" class="text-red-500 hover:text-red-700">‚úï</button>`:""}
      </div>
    </div>`;
  });
  document.getElementById("emptyState").classList.toggle("hidden", filtered.length>0);
};

// UPDATE PRICE
window.updatePrice = function(id,newPrice){
  if(!newPrice.startsWith("‡ß≥")) newPrice="‡ß≥ "+newPrice;
  set(ref(db,"inventory/"+id+"/price"), newPrice);
};

// TOGGLE STOCK
window.toggleStock = function(id){
  const stockRef = ref(db,"inventory/"+id+"/inStock");
  get(stockRef).then(snap=>{ set(stockRef,!snap.val()); });
};

// DELETE ITEM
window.deleteItem = function(id){ if(confirm("Delete this item?")) remove(ref(db,"inventory/"+id)); };

// PDF EXPORT
window.generatePDF = function(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(20);
  doc.text("HASAN TELECOM - INVENTORY REPORT",14,20);
  const tableRows = data.map(i=>[i.brand,i.model,i.category,i.subCategory,i.inStock?"YES":"NO",i.price]);
  doc.autoTable({ startY:30, head:[['Brand','Model','Category','Sub-category','Stock','Price']], body:tableRows });
  doc.save('HasanTelecom_Report.pdf');
};

// INITIAL LOAD
loadInventory();
addRow();
</script>
</body>
</html>
